<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_x_mobile_lis_endpoint_tree" model="ir.ui.view">
        <field name="name">x.mobile.lis.endpoint.tree</field>
        <field name="model">x_mobile.lis.endpoint</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="base_url"/>
                <field name="endpoint_code"/>
                <field name="auth_type"/>
                <field name="active"/>
            </list>
        </field>
    </record>

    <record id="view_x_mobile_lis_endpoint_form" model="ir.ui.view">
        <field name="name">x.mobile.lis.endpoint.form</field>
        <field name="model">x_mobile.lis.endpoint</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_sync_metadata" type="object" string="Sync Metadata" class="btn-primary"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="active"/>
                            <field name="base_url"/>
                            <field name="endpoint_code"/>
                            <field name="auth_type"/>
                            <field name="timeout_seconds"/>
                            <field name="verify_ssl"/>
                            <field name="metadata_sync_time" readonly="1"/>
                            <field name="metadata_sync_message" readonly="1"/>
                        </group>
                        <group>
                            <field name="api_key" password="True" invisible="auth_type != 'api_key'"/>
                            <field name="bearer_token" password="True" invisible="auth_type != 'bearer'"/>
                            <field name="username" invisible="auth_type != 'basic'"/>
                            <field name="password" password="True" invisible="auth_type != 'basic'"/>
                            <field name="notes"/>
                        </group>
                    </group>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="view_x_mobile_lis_mapping_line_tree" model="ir.ui.view">
        <field name="name">x.mobile.lis.mapping.line.tree</field>
        <field name="model">x_mobile.lis.mapping.line</field>
        <field name="arch" type="xml">
            <list editable="bottom">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="line_type" required="1"/>
                <field name="service_meta_id" domain="[('endpoint_id', '=', mapping_id.endpoint_id), ('item_type', '=', 'service'), ('active', '=', True)]" invisible="line_type != 'service'"/>
                <field name="service_code" required="line_type == 'service'" invisible="line_type != 'service'"/>
                <field name="profile_meta_id" domain="[('endpoint_id', '=', mapping_id.endpoint_id), ('item_type', '=', 'profile'), ('active', '=', True)]" invisible="line_type != 'profile'"/>
                <field name="profile_code" required="line_type == 'profile'" invisible="line_type != 'profile'"/>
                <field name="specimen_ref_mode"/>
                <field name="specimen_ref_fixed" invisible="specimen_ref_mode != 'fixed'"/>
                <field name="specimen_ref_component_id" domain="[('form_id', '=', parent.form_id)]" invisible="specimen_ref_mode != 'field'"/>
                <field name="specimen_barcode_component_id" domain="[('form_id', '=', parent.form_id)]"/>
                <field name="specimen_sample_type_mode"/>
                <field name="specimen_sample_type_meta_id" domain="[('endpoint_id', '=', mapping_id.endpoint_id), ('item_type', '=', 'sample_type'), ('active', '=', True)]" invisible="specimen_sample_type_mode != 'fixed'"/>
                <field name="specimen_sample_type_fixed" invisible="specimen_sample_type_mode != 'fixed'"/>
                <field name="specimen_sample_type_component_id" domain="[('form_id', '=', parent.form_id)]" invisible="specimen_sample_type_mode != 'field'"/>
                <field name="note_component_id" domain="[('form_id', '=', parent.form_id)]"/>
            </list>
        </field>
    </record>

    <record id="view_x_mobile_lis_mapping_specimen_tree" model="ir.ui.view">
        <field name="name">x.mobile.lis.mapping.specimen.tree</field>
        <field name="model">x_mobile.lis.mapping.specimen</field>
        <field name="arch" type="xml">
            <list editable="bottom">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="specimen_ref_mode"/>
                <field name="specimen_ref_fixed" invisible="specimen_ref_mode != 'fixed'"/>
                <field name="specimen_ref_component_id" invisible="specimen_ref_mode != 'field'"/>
                <field name="specimen_sample_type_mode"/>
                <field name="specimen_sample_type_meta_id" invisible="specimen_sample_type_mode != 'fixed'"/>
                <field name="specimen_sample_type_fixed" invisible="specimen_sample_type_mode != 'fixed'"/>
                <field name="specimen_sample_type_component_id" invisible="specimen_sample_type_mode != 'field'"/>
                <field name="specimen_barcode_component_id"/>
            </list>
        </field>
    </record>

    <record id="view_x_mobile_lis_mapping_combo_tree" model="ir.ui.view">
        <field name="name">x.mobile.lis.mapping.combo.tree</field>
        <field name="model">x_mobile.lis.mapping.combo</field>
        <field name="arch" type="xml">
            <list>
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="service_count"/>
                <field name="profile_count"/>
                <field name="specimen_count"/>
            </list>
        </field>
    </record>

    <record id="view_x_mobile_lis_mapping_combo_kanban" model="ir.ui.view">
        <field name="name">x.mobile.lis.mapping.combo.kanban</field>
        <field name="model">x_mobile.lis.mapping.combo</field>
        <field name="arch" type="xml">
            <kanban default_group_by="mapping_id" class="o_kanban_small_column">
                <field name="name"/>
                <field name="service_count"/>
                <field name="profile_count"/>
                <field name="specimen_count"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click o_kanban_record">
                            <div class="o_kanban_record_title">
                                <strong><field name="name"/></strong>
                            </div>
                            <div class="text-muted">Services: <field name="service_count"/></div>
                            <div class="text-muted">Profiles: <field name="profile_count"/></div>
                            <div class="text-muted">Specimens: <field name="specimen_count"/></div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_x_mobile_lis_mapping_combo_form" model="ir.ui.view">
        <field name="name">x.mobile.lis.mapping.combo.form</field>
        <field name="model">x_mobile.lis.mapping.combo</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="note_component_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Projects">
                            <group>
                                <field name="service_meta_ids" widget="many2many_tags" options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="profile_meta_ids" widget="many2many_tags" options="{'no_create': True, 'no_create_edit': True}"/>
                            </group>
                        </page>
                        <page string="Specimens">
                            <field name="specimen_ids" context="{'default_combo_id': id}" mode="list">
                                <list editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="name"/>
                                    <field name="specimen_ref_mode"/>
                                    <field name="specimen_ref_fixed" invisible="specimen_ref_mode != 'fixed'"/>
                                    <field name="specimen_ref_component_id" invisible="specimen_ref_mode != 'field'"/>
                                    <field name="specimen_sample_type_mode"/>
                                    <field name="specimen_sample_type_meta_id" invisible="specimen_sample_type_mode != 'fixed'"/>
                                    <field name="specimen_sample_type_fixed" invisible="specimen_sample_type_mode != 'fixed'"/>
                                    <field name="specimen_sample_type_component_id" invisible="specimen_sample_type_mode != 'field'"/>
                                    <field name="specimen_barcode_component_id"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_x_mobile_lis_mapping_tree" model="ir.ui.view">
        <field name="name">x.mobile.lis.mapping.tree</field>
        <field name="model">x_mobile.lis.mapping</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="form_id"/>
                <field name="endpoint_id"/>
                <field name="active"/>
            </list>
        </field>
    </record>

    <record id="view_x_mobile_lis_mapping_form" model="ir.ui.view">
        <field name="name">x.mobile.lis.mapping.form</field>
        <field name="model">x_mobile.lis.mapping</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="active"/>
                            <field name="form_id" required="1"/>
                            <field name="endpoint_id" required="1" readonly="not form_id"/>
                        </group>
                        <group>
                            <field name="external_uid_component_id" readonly="not form_id"/>
                            <field name="patient_name_component_id" readonly="not form_id"/>
                            <field name="patient_identifier_component_id" readonly="not form_id"/>
                            <field name="patient_gender_component_id" readonly="not form_id"/>
                            <field name="patient_birthdate_component_id" readonly="not form_id"/>
                            <field name="patient_phone_component_id" readonly="not form_id"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="physician_name_component_id" readonly="not form_id"/>
                            <field name="physician_ref_component_id" readonly="not form_id"/>
                            <field name="clinical_note_component_ids" widget="many2many_tags" options="{'no_create': True, 'no_create_edit': True}" readonly="not form_id"/>
                            <field name="clinical_note_component_id" readonly="not form_id" invisible="1"/>
                            <field name="preferred_template_component_id" readonly="not form_id"/>
                        </group>
                        <group>
                            <field name="priority_mode"/>
                            <field name="priority_fixed" invisible="priority_mode != 'fixed'"/>
                            <field name="priority_component_id" invisible="priority_mode != 'field'" readonly="not form_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Request Lines">
                            <field name="line_ids" context="{'default_mapping_id': id}" mode="list,form" readonly="not form_id">
                                <list editable="bottom" open_form_view="1">
                                    <field name="sequence" widget="handle"/>
                                    <field name="name"/>
                                    <field name="line_type" required="1"/>
                                    <field name="service_meta_id" domain="[('endpoint_id', '=', parent.endpoint_id), ('item_type', '=', 'service'), ('active', '=', True)]" invisible="line_type != 'service'"/>
                                    <field name="service_code" required="line_type == 'service'" invisible="line_type != 'service'"/>
                                    <field name="profile_meta_id" domain="[('endpoint_id', '=', parent.endpoint_id), ('item_type', '=', 'profile'), ('active', '=', True)]" invisible="line_type != 'profile'"/>
                                    <field name="profile_code" required="line_type == 'profile'" invisible="line_type != 'profile'"/>
                                    <field name="specimen_ref_mode"/>
                                    <field name="specimen_ref_fixed" invisible="specimen_ref_mode != 'fixed'"/>
                                    <field name="specimen_ref_component_id" domain="[('form_id', '=', parent.form_id)]" invisible="specimen_ref_mode != 'field'"/>
                                    <field name="specimen_barcode_component_id" domain="[('form_id', '=', parent.form_id)]"/>
                                    <field name="specimen_sample_type_mode"/>
                                    <field name="specimen_sample_type_meta_id" domain="[('endpoint_id', '=', parent.endpoint_id), ('item_type', '=', 'sample_type'), ('active', '=', True)]" invisible="specimen_sample_type_mode != 'fixed'"/>
                                    <field name="specimen_sample_type_fixed" invisible="specimen_sample_type_mode != 'fixed'"/>
                                    <field name="specimen_sample_type_component_id" domain="[('form_id', '=', parent.form_id)]" invisible="specimen_sample_type_mode != 'field'"/>
                                    <field name="note_component_id" domain="[('form_id', '=', parent.form_id)]"/>
                                </list>
                                <form>
                                    <group>
                                        <group>
                                            <field name="name"/>
                                            <field name="line_type"/>
                                        </group>
                                        <group>
                                            <field name="service_meta_id" domain="[('endpoint_id', '=', parent.endpoint_id), ('item_type', '=', 'service'), ('active', '=', True)]" invisible="line_type != 'service'"/>
                                            <field name="service_code" invisible="line_type != 'service'"/>
                                            <field name="profile_meta_id" domain="[('endpoint_id', '=', parent.endpoint_id), ('item_type', '=', 'profile'), ('active', '=', True)]" invisible="line_type != 'profile'"/>
                                            <field name="profile_code" invisible="line_type != 'profile'"/>
                                        </group>
                                    </group>
                                    <group string="Specimen">
                                        <field name="specimen_ref_mode"/>
                                        <field name="specimen_ref_fixed" invisible="specimen_ref_mode != 'fixed'"/>
                                        <field name="specimen_ref_component_id" domain="[('form_id', '=', parent.form_id)]" invisible="specimen_ref_mode != 'field'"/>
                                        <field name="specimen_barcode_component_id" domain="[('form_id', '=', parent.form_id)]"/>
                                        <field name="specimen_sample_type_mode"/>
                                        <field name="specimen_sample_type_meta_id" domain="[('endpoint_id', '=', parent.endpoint_id), ('item_type', '=', 'sample_type'), ('active', '=', True)]" invisible="specimen_sample_type_mode != 'fixed'"/>
                                        <field name="specimen_sample_type_fixed" invisible="specimen_sample_type_mode != 'fixed'"/>
                                        <field name="specimen_sample_type_component_id" domain="[('form_id', '=', parent.form_id)]" invisible="specimen_sample_type_mode != 'field'"/>
                                        <field name="note_component_id" domain="[('form_id', '=', parent.form_id)]"/>
                                    </group>
                                </form>
                            </field>
                            <div class="o_form_label">Add request lines directly. Each line binds one service/profile and one specimen rule.</div>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="view_x_mobile_submission_tree_lis_push" model="ir.ui.view">
        <field name="name">x.mobile.form.submission.tree.lis.push</field>
        <field name="model">x_mobile.form.submission</field>
        <field name="arch" type="xml">
            <list create="false">
                <header>
                    <button name="action_push_to_lis" type="object" string="Push to LIS" class="btn-primary"/>
                </header>
                <field name="name"/>
                <field name="form_id"/>
                <field name="submit_date"/>
                <field name="is_confirmed"/>
                <field name="lis_push_state"/>
                <field name="lis_request_no"/>
                <field name="lis_push_time"/>
                <field name="lis_push_message"/>
            </list>
        </field>
    </record>

    <record id="view_x_mobile_submission_search_lis_push" model="ir.ui.view">
        <field name="name">x.mobile.form.submission.search.lis.push</field>
        <field name="model">x_mobile.form.submission</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="form_id"/>
                <field name="lis_request_no"/>
                <separator/>
                <filter name="filter_lis_not_pushed" string="Not Pushed" domain="[('lis_push_state','=','none')]"/>
                <filter name="filter_lis_success" string="Pushed" domain="[('lis_push_state','=','success')]"/>
                <filter name="filter_lis_failed" string="Failed" domain="[('lis_push_state','=','failed')]"/>
                <separator/>
                <filter name="group_by_form" string="Form" context="{'group_by': 'form_id'}"/>
                <filter name="group_by_lis_push_state" string="Push State" context="{'group_by': 'lis_push_state'}"/>
            </search>
        </field>
    </record>

    <record id="action_x_mobile_lis_endpoint" model="ir.actions.act_window">
        <field name="name">LIS Endpoints</field>
        <field name="res_model">x_mobile.lis.endpoint</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_x_mobile_lis_mapping" model="ir.actions.act_window">
        <field name="name">LIS Mappings</field>
        <field name="res_model">x_mobile.lis.mapping</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_x_mobile_submission_lis_push" model="ir.actions.act_window">
        <field name="name">LIS Push Center</field>
        <field name="res_model">x_mobile.form.submission</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_x_mobile_submission_tree_lis_push"/>
        <field name="search_view_id" ref="view_x_mobile_submission_search_lis_push"/>
        <field name="context">{'create': False}</field>
    </record>

    <menuitem id="menu_x_mobile_lis_push_center" name="LIS Push Center" parent="menu_x_mobile_root" action="action_x_mobile_submission_lis_push" sequence="25" groups="mobile_form_builder.group_mobile_form_admin,mobile_form_builder.group_mobile_form_user"/>
    <menuitem id="menu_x_mobile_lis_config_root" name="LIS Integration" parent="menu_x_mobile_root" sequence="40" groups="mobile_form_builder.group_mobile_form_admin"/>
    <menuitem id="menu_x_mobile_lis_endpoint" name="LIS Endpoints" parent="menu_x_mobile_lis_config_root" action="action_x_mobile_lis_endpoint" sequence="10" groups="mobile_form_builder.group_mobile_form_admin"/>
    <menuitem id="menu_x_mobile_lis_mapping" name="LIS Mappings" parent="menu_x_mobile_lis_config_root" action="action_x_mobile_lis_mapping" sequence="20" groups="mobile_form_builder.group_mobile_form_admin"/>
</odoo>
